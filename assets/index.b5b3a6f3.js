import{D as I,B as w,g as M,h as o,r as T,o as d,c as p,a as l,b as f,w as h,F as x,i as C,j as g,k as c,t as S,l as v,p as b,m as R,I as L,T as B}from"./vendor.de715954.js";const n=new I("myDatabase");n.version("1.0").stores({timeRecord:"++id,date,time",tempTimeRecord:"++id,date,time"}).upgrade(e=>{});const Y=(e,r)=>{const s=e.__vccOpts||e;for(const[i,t]of r)s[i]=t;return s},A={components:{AntButton:w,RangePicker:M},props:{formatTime:Function,runState:Number},computed:{showDelete(){return[0,2].includes(this.runState)}},data(){return{presetsRange:[{label:"7\u5929\u524D",value:[o().add(-7,"d"),o()]},{label:"14\u5929\u524D",value:[o().add(-14,"d"),o()]},{label:"30\u5929\u524D",value:[o().add(-30,"d"),o()]},{label:"90\u5929\u524D",value:[o().add(-90,"d"),o()]}],search:{date:[o().add(-30,"d"),o()]},historyRecords:[]}},methods:{format(e,r){return o(e).format(r)},abledRegress(e){return o(new Date(e)).format("YYYY/MM/DD")===o().format("YYYY/MM/DD")&&[0,2].includes(this.runState)},getData(){let e=this.search.date;const r=o(e[0]).startOf("day").toDate(),s=o(e[1]).endOf("day").toDate();n.timeRecord.where("date").between(r,s).toArray().then(i=>{if(i.length==0){this.historyRecords=[];return}i.forEach(t=>t.date=t.date.toLocaleString()),this.historyRecords=i.reverse()}).catch(i=>{this.historyRecords=[],console.error("\u83B7\u5F97\u6570\u636E\u51FA\u9519",i)})},resetHistoryStorage(){confirm("\u662F\u5426\u786E\u8BA4\u5220\u9664\u6240\u6709\u5386\u53F2\u8BB0\u5F55?")!==!1&&n.timeRecord.clear().then(()=>{this.getData()}).catch(e=>{console.error("\u8868\u6570\u636E\u5220\u9664\u5931\u8D25:",e)})},printHistoryStorage(){let e=this.search.date;const r=e[1].add(1,"days").format("YYYY-MM-DD");let s={};this.historyRecords.forEach(t=>{let a=o(t.date).format("YYYY-MM-DD");s[a]=this.formatTime(t.time)});let i="";for(let t=e[0];t.format("YYYY-MM-DD")!=r;){let a=t.format("YYYY-MM-DD");s[a]?i+=s[a]+`\r
`:i+=`0\r
`,t=t.add(1,"days")}console.log(i)},deleteRecord(e,r){confirm(`\u662F\u5426\u5220\u9664${e.date},\u65F6\u957F\u4E3A${this.formatTime(e.time)}\u7684\u8BB0\u5F55 \uFF1F`)!==!1&&n.timeRecord.delete(e.id).then(()=>{this.getData()}).catch(s=>{alert("\u6570\u636E\u5220\u9664\u5931\u8D25:",s)})}}},N=e=>(b("data-v-dab79b70"),e=e(),R(),e),H={class:"history_wrap"},z={class:"history_header"},$=c(" \u5386\u53F2\u8BB0\u5F55 "),j=c("\u91CD\u7F6E"),P=c("\u6253\u5370"),O=N(()=>l("hr",{class:"history_hr"},null,-1)),V={id:"history"},E={key:0,class:"content_loop_wrap"},F={class:"date"},U={class:"studio_time"},K=c(" \u7EE7\u7EED "),q=c(" \u5220\u9664 "),G={key:1,class:"no_content_wrap"};function J(e,r,s,i,t,a){const D=T("RangePicker"),m=T("AntButton");return d(),p("section",H,[l("header",z,[$,l("div",null,[f(D,{presets:t.presetsRange,value:t.search.date,"onUpdate:value":r[0]||(r[0]=u=>t.search.date=u),onChange:a.getData,allowClear:!1,size:"large"},null,8,["presets","value","onChange"]),f(m,{class:"timer_btn",size:"large",onClick:a.resetHistoryStorage},{default:h(()=>[j]),_:1},8,["onClick"]),f(m,{class:"timer_btn",size:"large",onClick:a.printHistoryStorage},{default:h(()=>[P]),_:1},8,["onClick"])])]),O,l("div",V,[t.historyRecords.length!==0?(d(),p("div",E,[(d(!0),p(x,null,C(t.historyRecords,(u,y)=>(d(),p("div",{key:y,class:"content_wrap"},[l("div",F,S(a.format(new Date(u.date),"YYYY/MM/DD hh:mm:ss")),1),l("div",U,S(s.formatTime(u.time)),1),f(m,{disabled:a.abledRegress(u.date)==!1,size:"small",style:{"margin-left":"10px"},onClick:_=>e.$emit("continue",u,y)},{default:h(()=>[K]),_:2},1032,["disabled","onClick"]),a.showDelete?(d(),v(m,{key:0,size:"small",style:{"margin-left":"10px"},onClick:_=>a.deleteRecord(u,y)},{default:h(()=>[q]),_:2},1032,["onClick"])):g("",!0)]))),128))])):g("",!0),t.historyRecords.length==0?(d(),p("div",G," \u6682\u65E0\u6570\u636E... ")):g("",!0)])])}const Q=Y(A,[["render",J],["__scopeId","data-v-dab79b70"]]);const W={components:{AntButton:w,HistoryList:Q,InputNumber:L,Tag:B},data(){return{startTime:null,runTime:0,runState:0,formattedTime:"00:00:00",timerInterval:null,historyRecords:[],addTime:0,timeId:-1,autoSaveTimer:null}},computed:{showDelete(){return[0,2].includes(this.runState)},getTag(){let e={text:"",color:""};return[0,2].includes(this.runState)?(e.text=this.runState==2?"\u6682\u505C\u4E2D":"\u672A\u5F00\u59CB",e.color="success"):(e.text="\u8FDB\u884C\u4E2D",e.color="gold"),e}},watch:{runState:function(e){e===1?this.startAutoSave():this.stopAutoSave()}},mounted(){this.timeId=-1,this.$refs.historyList.getData(),this.init()},methods:{init(){window.addRecord=function(e){if(isNaN(new Date(e))||typeof e!="string")return alert("date\u5FC5\u987B\u662F\u683C\u5F0F\u5316\u65E5\u671F\u5B57\u7B26\u4E32\uFF0C\u5982"+o(new Date).format("YYYY-MM-DD 23:30:00"));let r=window.prompt(`\u8BF7\u8F93\u5165 ${e} \u5BF9\u5E94\u7684\u5206\u949F\u6570`);if(!/\d*/.test(r))return alert("time\u5FC5\u987B\u6570\u5206\u949F\u6570\uFF08\u53EA\u542B\u6570\u5B57\uFF09");!confirm(`\u65E5\u671F ${e}\uFF0C\u5206\u949F\u6570:${r} ,\u662F\u5426\u786E\u8BA4\u6DFB\u52A0?`)||n.timeRecord.add({date:new Date(e),time:r*60*1e3}).then(s=>{this.$refs.historyList.getData()}).catch(s=>{alert("\u6DFB\u52A0\u5931\u8D25")})}.bind(this),console.log('\u624B\u52A8\u52A0\u8BB0\u5F55\u65B9\u6CD5 addRecord("'+o().format("YYYY-MM-DD 23:30:00")+'")'),window.getTemp=function(){n.tempTimeRecord.toArray().then(e=>console.log(e.reverse()))},console.log("\u83B7\u5F97\u4E34\u65F6\u6570\u636E getTemp()"),window.addBatchTimeData=function(e){function r(s){return Object.prototype.toString.call(s).slice(8,-1).toLowerCase()}if(confirm("\u6DFB\u52A0\u662F\u5426\u6570\u636E\uFF1F")!==!1){console.log(e);for(let s of e){if(r(s.date)!=="date")return console.log("date\u6570\u636E\u4E0D\u5408\u89C4",s),alert("date\u6570\u636E\u4E0D\u5408\u89C4",s);if(r(s.time)!=="number")return console.log("time\u6570\u636E\u4E0D\u5408\u89C4",s),alert("time\u6570\u636E\u4E0D\u5408\u89C4",s)}n.timeRecord.bulkPut(e).then(()=>{alert("\u6570\u636E\u6DFB\u52A0\u6210\u529F")}).catch(s=>{console.error("\u65E0\u6CD5\u6DFB\u52A0\u6570\u636E:",s),alert("\u6570\u636E\u6DFB\u52A0\u6210\u529F")})}}},startAutoSave(){this.autoSaveTimer=setInterval(()=>{this.autoSaveHandle()},1e3*60*5)},stopAutoSave(){this.autoSaveHandle(),clearInterval(this.autoSaveTimer),this.autoSaveTimer=null},autoSaveHandle(){let e=this.runTime;if(this.runState===1&&(e+=performance.now()-this.startTime),e<60*1e3)return;let r={date:new Date().toLocaleString(),time:this.formatTime(Math.floor(e))};if(this.timeId!=-1){n.tempTimeRecord.update(this.timeId,r).then(()=>{}).catch(s=>{console.error("\u6570\u636E\u66F4\u65B0\u5931\u8D25:",s)});return}n.tempTimeRecord.add(r).then(async s=>{this.timeId=s;try{let i=await n.tempTimeRecord.count(),t=localStorage.getItem("tempTimeLength");t=Number(t)||100;let a=await n.tempTimeRecord.orderBy("id").limit(i-t).primaryKeys();if(a.length===0)return;await n.tempTimeRecord.bulkDelete(a)}catch(i){console.log(i),alert("\u5220\u9664\u81EA\u52A8\u4FDD\u5B58\u4E34\u65F6\u6570\u636E\u5931\u8D25")}}).catch(s=>{alert("\u81EA\u52A8\u4FDD\u5B58\u5931\u8D25")})},continueTime(e,r){confirm("\u662F\u5426\u786E\u8BA4\u7EE7\u7EED\uFF1F")!==!1&&(this.$refs.historyList.historyRecords.splice(e.oIdx,1),this.runTime+=e.time,this.startTime=performance.now(),n.timeRecord.delete(e.id).then(()=>{this.$refs.historyList.getData()}).catch(s=>{alert("\u6570\u636E\u5220\u9664\u5931\u8D25:",s)}),this.updateTimer())},addTimer(){confirm("\u662F\u5426\u786E\u8BA4\u52A0\u51CF\u65F6\u95F4?")!==!1&&(this.startTime=performance.now(),this.runTime+=this.addTime*1e3*60,this.runTime=Math.max(0,this.runTime),this.updateTimer())},startTimer(){this.startTime=performance.now(),this.updateTimer(),this.timerInterval=setInterval(this.updateTimer,1e3),this.runState=1},pauseTimer(){this.runTime+=performance.now()-this.startTime,this.startTime=performance.now(),this.runState=2,this.updateTimer(),clearInterval(this.timerInterval)},stopTimer(){clearInterval(this.timerInterval),this.runState===1&&(this.runTime+=performance.now()-this.startTime),n.timeRecord.add({date:new Date,time:Math.floor(this.runTime)}).then(e=>{this.startTime=null,this.formattedTime="00:00:00",this.runTime=0,this.runState=0,this.timeId=-1,this.$refs.historyList.getData()}).catch(e=>{alert("\u6DFB\u52A0\u5931\u8D25")})},updateTimer(){this.formattedTime=this.formatTime(performance.now()-this.startTime+this.runTime)},formatTime(e){e=Math.floor(Math.floor(e)/1e3);const r=Math.floor(e/3600).toString().padStart(2,"0"),s=Math.floor(e%3600/60).toString().padStart(2,"0"),i=(e%60).toString().padStart(2,"0");return`${r}:${s}:${i}`}}},k=e=>(b("data-v-f24d8560"),e=e(),R(),e),X={class:"timer_wrap"},Z={class:"timer_header"},ee=k(()=>l("span",null,"\u8BA1\u65F6\u5668",-1)),te=k(()=>l("hr",{class:"timer_hr"},null,-1)),re={class:"timer_show"},se={class:"timer-btn-list"},ae=c(" \u5F00\u59CB "),ie=c(" \u6682\u505C "),oe=c(" \u7ED3\u675F "),ne=c(" \u52A0\u51CF\u65F6 ");function le(e,r,s,i,t,a){const D=T("Tag"),m=T("AntButton"),u=T("InputNumber"),y=T("HistoryList");return d(),p("div",null,[l("section",X,[l("header",Z,[ee,[0,1,2].includes(t.runState)?(d(),v(D,{key:0,bordered:!1,class:"timer_tag",color:a.getTag.color},{default:h(()=>[c(S(a.getTag.text),1)]),_:1},8,["color"])):g("",!0)]),te,l("div",re,S(t.formattedTime),1),l("div",se,[f(m,{disabled:!(t.runState==0||t.runState==2),class:"start",size:"large",type:"primary",onClick:r[0]||(r[0]=_=>a.startTimer())},{default:h(()=>[ae]),_:1},8,["disabled"]),f(m,{disabled:t.runState!=1,class:"pause",size:"large",type:"primary",onClick:r[1]||(r[1]=_=>a.pauseTimer())},{default:h(()=>[ie]),_:1},8,["disabled"]),f(m,{disabled:!(t.runState==1||t.runState==2),class:"stop",danger:"",size:"large",onClick:r[2]||(r[2]=_=>a.stopTimer())},{default:h(()=>[oe]),_:1},8,["disabled"]),t.runState==2?(d(),v(u,{key:0,style:{width:"120px","margin-left":"30px"},size:"large",type:"number",class:"common_input",value:t.addTime,"onUpdate:value":r[3]||(r[3]=_=>t.addTime=_)},null,8,["value"])):g("",!0),t.runState==2?(d(),v(m,{key:1,class:"",size:"large",onClick:r[4]||(r[4]=_=>a.addTimer())},{default:h(()=>[ne]),_:1})):g("",!0)])]),f(y,{ref:"historyList",formatTime:a.formatTime,runState:t.runState,onContinue:a.continueTime},null,8,["formatTime","runState","onContinue"])])}const ce=Y(W,[["render",le],["__scopeId","data-v-f24d8560"]]);export{ce as default};
