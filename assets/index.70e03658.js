import{D as I,B as w,g as M,h as i,r as g,o as u,c as T,a as d,b as _,w as f,F as x,i as C,j as y,k as h,t as D,l as S,p as R,m as Y,I as L,T as B,n as A}from"./vendor.9033921d.js";const n=new I("myDatabase");n.version("1.0").stores({timeRecord:"++id,date,time",tempTimeRecord:"++id,date,time"}).upgrade(e=>{});const b=(e,r)=>{const t=e.__vccOpts||e;for(const[o,s]of r)t[o]=s;return t},N={components:{AntButton:w,RangePicker:M},props:{formatTime:Function,runState:Number},computed:{showDelete(){return[0,2].includes(this.runState)}},data(){return{presetsRange:[{label:"7\u5929\u524D",value:[i().add(-7,"d"),i()]},{label:"14\u5929\u524D",value:[i().add(-14,"d"),i()]},{label:"30\u5929\u524D",value:[i().add(-30,"d"),i()]},{label:"90\u5929\u524D",value:[i().add(-90,"d"),i()]}],search:{date:[i().add(-30,"d"),i()]},historyRecords:[]}},methods:{format(e,r){return i(e).format(r)},abledRegress(e){return i(new Date(e)).format("YYYY/MM/DD")===i().format("YYYY/MM/DD")&&[0,2].includes(this.runState)},getData(){let e=this.search.date;const r=i(e[0]).startOf("day").toDate(),t=i(e[1]).endOf("day").toDate();n.timeRecord.where("date").between(r,t).toArray().then(o=>{if(o.length==0){this.historyRecords=[];return}o.forEach(s=>s.date=s.date.toLocaleString()),this.historyRecords=o.reverse()}).catch(o=>{this.historyRecords=[],console.error("\u83B7\u5F97\u6570\u636E\u51FA\u9519",o)})},resetHistoryStorage(){confirm("\u662F\u5426\u786E\u8BA4\u5220\u9664\u6240\u6709\u5386\u53F2\u8BB0\u5F55?")!==!1&&n.timeRecord.clear().then(()=>{this.getData()}).catch(e=>{console.error("\u8868\u6570\u636E\u5220\u9664\u5931\u8D25:",e)})},async printHistoryStorage(){let e=this.search.date;const r=e[1].add(1,"days").format("YYYY-MM-DD");let t={};this.historyRecords.forEach(a=>{let c=i(a.date).format("YYYY-MM-DD");t[c]=(a.time/1e3/3600).toFixed(2)}),(await n.tempTimeRecord.toArray()).forEach(a=>{let c=i(a.date).format("YYYY-MM-DD");if(!t[c]){let l=a.time.split(":").map(m=>Number(m));t[c]=(l[0]+l[1]/60).toFixed(3)}});let s="";for(let a=e[0];a.format("YYYY-MM-DD")!=r;){let c=a.format("YYYY-MM-DD");t[c]?s+=t[c]+`\r
`:s+=`0\r
`,a=a.add(1,"days")}console.log(s)},deleteRecord(e,r){confirm(`\u662F\u5426\u5220\u9664${e.date},\u65F6\u957F\u4E3A${this.formatTime(e.time)}\u7684\u8BB0\u5F55 \uFF1F`)!==!1&&n.timeRecord.delete(e.id).then(()=>{this.getData()}).catch(t=>{alert("\u6570\u636E\u5220\u9664\u5931\u8D25:",t)})}}},H=e=>(R("data-v-c449b54e"),e=e(),Y(),e),z={class:"history_wrap"},$={class:"history_header"},j=h(" \u5386\u53F2\u8BB0\u5F55 "),F=h("\u91CD\u7F6E"),P=h("\u6253\u5370"),E=H(()=>d("hr",{class:"history_hr"},null,-1)),O={id:"history"},V={key:0,class:"content_loop_wrap"},U={class:"date"},K={class:"studio_time"},q=h(" \u7EE7\u7EED "),G=h(" \u5220\u9664 "),J={key:1,class:"no_content_wrap"};function Q(e,r,t,o,s,a){const c=g("RangePicker"),l=g("AntButton");return u(),T("section",z,[d("header",$,[j,d("div",null,[_(c,{presets:s.presetsRange,value:s.search.date,"onUpdate:value":r[0]||(r[0]=m=>s.search.date=m),onChange:a.getData,allowClear:!1,size:"large"},null,8,["presets","value","onChange"]),_(l,{class:"timer_btn",size:"large",onClick:a.resetHistoryStorage},{default:f(()=>[F]),_:1},8,["onClick"]),_(l,{class:"timer_btn",size:"large",onClick:a.printHistoryStorage},{default:f(()=>[P]),_:1},8,["onClick"])])]),E,d("div",O,[s.historyRecords.length!==0?(u(),T("div",V,[(u(!0),T(x,null,C(s.historyRecords,(m,v)=>(u(),T("div",{key:v,class:"content_wrap"},[d("div",U,D(a.format(new Date(m.date),"YYYY/MM/DD hh:mm:ss")),1),d("div",K,D(t.formatTime(m.time)),1),_(l,{disabled:a.abledRegress(m.date)==!1,size:"small",style:{"margin-left":"10px"},onClick:p=>e.$emit("continue",m,v)},{default:f(()=>[q]),_:2},1032,["disabled","onClick"]),a.showDelete?(u(),S(l,{key:0,size:"small",style:{"margin-left":"10px"},onClick:p=>a.deleteRecord(m,v)},{default:f(()=>[G]),_:2},1032,["onClick"])):y("",!0)]))),128))])):y("",!0),s.historyRecords.length==0?(u(),T("div",J," \u6682\u65E0\u6570\u636E... ")):y("",!0)])])}const W=b(N,[["render",Q],["__scopeId","data-v-c449b54e"]]);const X={components:{AntButton:w,HistoryList:W,InputNumber:L,Tag:B},data(){return{startTime:null,runTime:0,runState:0,formattedTime:"00:00:00",timerInterval:null,historyRecords:[],addTime:0,timeId:-1,autoSaveTimer:null}},computed:{showDelete(){return[0,2].includes(this.runState)},getTag(){let e={text:"",color:""};return[0,2].includes(this.runState)?(e.text=this.runState==2?"\u6682\u505C\u4E2D":"\u672A\u5F00\u59CB",e.color="success"):(e.text="\u8FDB\u884C\u4E2D",e.color="gold"),e}},watch:{runState:function(e){e===1?this.startAutoSave():this.stopAutoSave()}},mounted(){this.timeId=-1,this.$refs.historyList.getData(),this.init()},methods:{init(){window.addRecord=function(e){if(isNaN(new Date(e))||typeof e!="string")return alert("date\u5FC5\u987B\u662F\u683C\u5F0F\u5316\u65E5\u671F\u5B57\u7B26\u4E32\uFF0C\u5982"+i(new Date).format("YYYY-MM-DD 23:30:00"));let r=window.prompt(`\u8BF7\u8F93\u5165 ${e} \u5BF9\u5E94\u7684\u5206\u949F\u6570`);if(!/\d*/.test(r))return alert("time\u5FC5\u987B\u6570\u5206\u949F\u6570\uFF08\u53EA\u542B\u6570\u5B57\uFF09");!confirm(`\u65E5\u671F ${e}\uFF0C\u5206\u949F\u6570:${r} ,\u662F\u5426\u786E\u8BA4\u6DFB\u52A0?`)||n.timeRecord.add({date:new Date(e),time:r*60*1e3}).then(t=>{this.$refs.historyList.getData()}).catch(t=>{alert("\u6DFB\u52A0\u5931\u8D25")})}.bind(this),console.log('\u624B\u52A8\u52A0\u8BB0\u5F55\u65B9\u6CD5 addRecord("'+i().format("YYYY-MM-DD 23:30:00")+'")'),window.getTemp=function(){n.tempTimeRecord.toArray().then(e=>console.log(e.reverse()))},console.log("\u83B7\u5F97\u4E34\u65F6\u6570\u636E getTemp()"),window.addBatchTimeData=function(e){function r(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}if(confirm("\u6DFB\u52A0\u662F\u5426\u6570\u636E\uFF1F")!==!1){console.log(e);for(let t of e){if(r(t.date)!=="date")return console.log("date\u6570\u636E\u4E0D\u5408\u89C4",t),alert("date\u6570\u636E\u4E0D\u5408\u89C4",t);if(r(t.time)!=="number")return console.log("time\u6570\u636E\u4E0D\u5408\u89C4",t),alert("time\u6570\u636E\u4E0D\u5408\u89C4",t)}n.timeRecord.bulkPut(e).then(()=>{alert("\u6570\u636E\u6DFB\u52A0\u6210\u529F")}).catch(t=>{console.error("\u65E0\u6CD5\u6DFB\u52A0\u6570\u636E:",t),alert("\u6570\u636E\u6DFB\u52A0\u6210\u529F")})}}},startAutoSave(){this.autoSaveTimer=setInterval(()=>{this.autoSaveHandle()},1e3*60*5)},stopAutoSave(){this.autoSaveHandle(),clearInterval(this.autoSaveTimer),this.autoSaveTimer=null},autoSaveHandle(){let e=this.runTime;if(this.runState===1&&(e+=performance.now()-this.startTime),e<60*1e3)return;let r={date:new Date().toLocaleString(),time:this.formatTime(Math.floor(e))};if(this.timeId!=-1){n.tempTimeRecord.update(this.timeId,r).then(()=>{}).catch(t=>{console.error("\u6570\u636E\u66F4\u65B0\u5931\u8D25:",t)});return}n.tempTimeRecord.add(r).then(async t=>{this.timeId=t;try{let o=await n.tempTimeRecord.count(),s=localStorage.getItem("tempTimeLength");s=Number(s)||100;let a=await n.tempTimeRecord.orderBy("id").limit(o-s).primaryKeys();if(a.length===0)return;await n.tempTimeRecord.bulkDelete(a)}catch(o){console.log(o),alert("\u5220\u9664\u81EA\u52A8\u4FDD\u5B58\u4E34\u65F6\u6570\u636E\u5931\u8D25")}}).catch(t=>{alert("\u81EA\u52A8\u4FDD\u5B58\u5931\u8D25")})},continueTime(e,r){confirm("\u662F\u5426\u786E\u8BA4\u7EE7\u7EED\uFF1F")!==!1&&(this.$refs.historyList.historyRecords.splice(e.oIdx,1),this.runTime+=e.time,this.startTime=performance.now(),n.timeRecord.delete(e.id).then(()=>{this.$refs.historyList.getData()}).catch(t=>{alert("\u6570\u636E\u5220\u9664\u5931\u8D25:",t)}),this.updateTimer())},addTimer(){confirm("\u662F\u5426\u786E\u8BA4\u52A0\u51CF\u65F6\u95F4?")!==!1&&(this.startTime=performance.now(),this.runTime+=this.addTime*1e3*60,this.runTime=Math.max(0,this.runTime),this.updateTimer(),this.addTime=0,A.success("\u6DFB\u52A0\u6210\u529F"))},startTimer(){this.startTime=performance.now(),this.updateTimer(),this.timerInterval=setInterval(this.updateTimer,1e3),this.runState=1},pauseTimer(){this.runTime+=performance.now()-this.startTime,this.startTime=performance.now(),this.runState=2,this.updateTimer(),clearInterval(this.timerInterval)},stopTimer(){clearInterval(this.timerInterval),this.runState===1&&(this.runTime+=performance.now()-this.startTime),n.timeRecord.add({date:new Date,time:Math.floor(this.runTime)}).then(e=>{this.startTime=null,this.formattedTime="00:00:00",this.runTime=0,this.runState=0,this.timeId=-1,this.$refs.historyList.getData()}).catch(e=>{alert("\u6DFB\u52A0\u5931\u8D25")})},updateTimer(){this.formattedTime=this.formatTime(performance.now()-this.startTime+this.runTime)},formatTime(e){e=Math.floor(Math.floor(e)/1e3);const r=Math.floor(e/3600).toString().padStart(2,"0"),t=Math.floor(e%3600/60).toString().padStart(2,"0"),o=(e%60).toString().padStart(2,"0");return`${r}:${t}:${o}`}}},k=e=>(R("data-v-17d9d345"),e=e(),Y(),e),Z={class:"timer_wrap"},ee={class:"timer_header"},te=k(()=>d("span",null,"\u8BA1\u65F6\u5668",-1)),re=k(()=>d("hr",{class:"timer_hr"},null,-1)),se={class:"timer_show"},ae={class:"timer-btn-list"},ie=h(" \u5F00\u59CB "),oe=h(" \u6682\u505C "),ne=h(" \u7ED3\u675F "),le=h(" \u52A0\u51CF\u65F6 ");function de(e,r,t,o,s,a){const c=g("Tag"),l=g("AntButton"),m=g("InputNumber"),v=g("HistoryList");return u(),T("div",null,[d("section",Z,[d("header",ee,[te,[0,1,2].includes(s.runState)?(u(),S(c,{key:0,bordered:!1,class:"timer_tag",color:a.getTag.color},{default:f(()=>[h(D(a.getTag.text),1)]),_:1},8,["color"])):y("",!0)]),re,d("div",se,D(s.formattedTime),1),d("div",ae,[_(l,{disabled:!(s.runState==0||s.runState==2),class:"start",size:"large",type:"primary",onClick:r[0]||(r[0]=p=>a.startTimer())},{default:f(()=>[ie]),_:1},8,["disabled"]),_(l,{disabled:s.runState!=1,class:"pause",size:"large",type:"primary",onClick:r[1]||(r[1]=p=>a.pauseTimer())},{default:f(()=>[oe]),_:1},8,["disabled"]),_(l,{disabled:!(s.runState==1||s.runState==2),class:"stop",danger:"",size:"large",onClick:r[2]||(r[2]=p=>a.stopTimer())},{default:f(()=>[ne]),_:1},8,["disabled"]),s.runState==2?(u(),S(m,{key:0,style:{width:"120px","margin-left":"30px"},size:"large",type:"number",class:"common_input",value:s.addTime,"onUpdate:value":r[3]||(r[3]=p=>s.addTime=p)},null,8,["value"])):y("",!0),s.runState==2?(u(),S(l,{key:1,class:"",size:"large",onClick:r[4]||(r[4]=p=>a.addTimer())},{default:f(()=>[le]),_:1})):y("",!0)])]),_(v,{ref:"historyList",formatTime:a.formatTime,runState:s.runState,onContinue:a.continueTime},null,8,["formatTime","runState","onContinue"])])}const me=b(X,[["render",de],["__scopeId","data-v-17d9d345"]]);export{me as default};
