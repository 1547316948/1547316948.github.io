import{D as x,B as D,g as Y,h as a,r as T,o as d,c as p,a as l,b as _,w as h,F as C,i as M,j as g,k as m,t as S,l as y,p as R,m as b,I as L,T as B}from"./vendor.de715954.js";const n=new x("myDatabase");n.version("1.0").stores({timeRecord:"++id,date,time",tempTimeRecord:"++id,date,time"}).upgrade(e=>{});const k=(e,t)=>{const r=e.__vccOpts||e;for(const[o,s]of t)r[o]=s;return r},A={components:{AntButton:D,RangePicker:Y},props:{formatTime:Function,runState:Number},computed:{showDelete(){return[0,2].includes(this.runState)}},data(){return{presetsRange:[{label:"7\u5929\u524D",value:[a().add(-7,"d"),a()]},{label:"14\u5929\u524D",value:[a().add(-14,"d"),a()]},{label:"30\u5929\u524D",value:[a().add(-30,"d"),a()]},{label:"90\u5929\u524D",value:[a().add(-90,"d"),a()]}],search:{date:[a().add(-30,"d"),a()]},historyRecords:[]}},methods:{format(e,t){return a(e).format(t)},abledRegress(e){return a(new Date(e)).format("YYYY/MM/DD")===a().format("YYYY/MM/DD")&&[0,2].includes(this.runState)},getData(){let e=this.search.date;const t=a(e[0]).startOf("day").toDate(),r=a(e[1]).endOf("day").toDate();n.timeRecord.where("date").between(t,r).toArray().then(o=>{if(o.length==0){this.historyRecords=[];return}o.forEach(s=>s.date=s.date.toLocaleString()),this.historyRecords=o.reverse()}).catch(o=>{this.historyRecords=[],console.error("\u83B7\u5F97\u6570\u636E\u51FA\u9519",o)})},resetHistoryStorage(){confirm("\u662F\u5426\u786E\u8BA4\u5220\u9664\u6240\u6709\u5386\u53F2\u8BB0\u5F55?")!==!1&&n.timeRecord.clear().then(()=>{this.getData()}).catch(e=>{console.error("\u8868\u6570\u636E\u5220\u9664\u5931\u8D25:",e)})},deleteRecord(e,t){confirm(`\u662F\u5426\u5220\u9664${e.date},\u65F6\u957F\u4E3A${this.formatTime(e.time)}\u7684\u8BB0\u5F55 \uFF1F`)!==!1&&n.timeRecord.delete(e.id).then(()=>{this.getData()}).catch(r=>{alert("\u6570\u636E\u5220\u9664\u5931\u8D25:",r)})}}},N=e=>(R("data-v-e800ed41"),e=e(),b(),e),z={class:"history_wrap"},H={class:"history_header"},$=m(" \u5386\u53F2\u8BB0\u5F55 "),P=m("\u91CD\u7F6E"),j=N(()=>l("hr",{class:"history_hr"},null,-1)),O={id:"history"},V={key:0,class:"content_loop_wrap"},F={class:"date"},E={class:"studio_time"},U=m(" \u7EE7\u7EED "),K=m(" \u5220\u9664 "),q={key:1,class:"no_content_wrap"};function G(e,t,r,o,s,i){const w=T("RangePicker"),u=T("AntButton");return d(),p("section",z,[l("header",H,[$,l("div",null,[_(w,{presets:s.presetsRange,value:s.search.date,"onUpdate:value":t[0]||(t[0]=c=>s.search.date=c),onChange:i.getData,allowClear:!1,size:"large"},null,8,["presets","value","onChange"]),_(u,{class:"timer_btn",size:"large",onClick:i.resetHistoryStorage},{default:h(()=>[P]),_:1},8,["onClick"])])]),j,l("div",O,[s.historyRecords.length!==0?(d(),p("div",V,[(d(!0),p(C,null,M(s.historyRecords,(c,v)=>(d(),p("div",{key:v,class:"content_wrap"},[l("div",F,S(i.format(new Date(c.date),"YYYY/MM/DD hh:mm:ss")),1),l("div",E,S(r.formatTime(c.time)),1),_(u,{disabled:i.abledRegress(c.date)==!1,size:"small",style:{"margin-left":"10px"},onClick:f=>e.$emit("continue",c,v)},{default:h(()=>[U]),_:2},1032,["disabled","onClick"]),i.showDelete?(d(),y(u,{key:0,size:"small",style:{"margin-left":"10px"},onClick:f=>i.deleteRecord(c,v)},{default:h(()=>[K]),_:2},1032,["onClick"])):g("",!0)]))),128))])):g("",!0),s.historyRecords.length==0?(d(),p("div",q," \u6682\u65E0\u6570\u636E... ")):g("",!0)])])}const J=k(A,[["render",G],["__scopeId","data-v-e800ed41"]]);const Q={components:{AntButton:D,HistoryList:J,InputNumber:L,Tag:B},data(){return{startTime:null,runTime:0,runState:0,formattedTime:"00:00:00",timerInterval:null,historyRecords:[],addTime:0,timeId:-1,autoSaveTimer:null}},computed:{showDelete(){return[0,2].includes(this.runState)},getTag(){let e={text:"",color:""};return[0,2].includes(this.runState)?(e.text=this.runState==2?"\u6682\u505C\u4E2D":"\u672A\u5F00\u59CB",e.color="success"):(e.text="\u8FDB\u884C\u4E2D",e.color="gold"),e}},watch:{runState:function(e){e===1?this.startAutoSave():this.stopAutoSave()}},mounted(){this.timeId=-1,this.$refs.historyList.getData(),this.init()},methods:{init(){window.addRecord=function(e){if(isNaN(new Date(e))||typeof e!="string")return alert("date\u5FC5\u987B\u662F\u683C\u5F0F\u5316\u65E5\u671F\u5B57\u7B26\u4E32\uFF0C\u5982"+a(new Date).format("YYYY-MM-DD 23:30:00"));let t=window.prompt(`\u8BF7\u8F93\u5165 ${e} \u5BF9\u5E94\u7684\u5206\u949F\u6570`);if(!/\d*/.test(t))return alert("time\u5FC5\u987B\u6570\u5206\u949F\u6570\uFF08\u53EA\u542B\u6570\u5B57\uFF09");!confirm(`\u65E5\u671F ${e}\uFF0C\u5206\u949F\u6570:${t} ,\u662F\u5426\u786E\u8BA4\u6DFB\u52A0?`)||n.timeRecord.add({date:new Date(e),time:t*60*1e3}).then(r=>{this.$refs.historyList.getData()}).catch(r=>{alert("\u6DFB\u52A0\u5931\u8D25")})}.bind(this),console.log('\u624B\u52A8\u52A0\u8BB0\u5F55\u65B9\u6CD5 addRecord("'+a().format("YYYY-MM-DD 23:30:00")+'")'),window.getTemp=function(){n.tempTimeRecord.toArray().then(e=>console.log(e.reverse()))},console.log("\u83B7\u5F97\u4E34\u65F6\u6570\u636E getTemp()"),window.addBatchTimeData=function(e){function t(r){return Object.prototype.toString.call(r).slice(8,-1).toLowerCase()}if(confirm("\u6DFB\u52A0\u662F\u5426\u6570\u636E\uFF1F")!==!1){console.log(e);for(let r of e){if(t(r.date)!=="date")return console.log("date\u6570\u636E\u4E0D\u5408\u89C4",r),alert("date\u6570\u636E\u4E0D\u5408\u89C4",r);if(t(r.time)!=="number")return console.log("time\u6570\u636E\u4E0D\u5408\u89C4",r),alert("time\u6570\u636E\u4E0D\u5408\u89C4",r)}n.timeRecord.bulkPut(e).then(()=>{alert("\u6570\u636E\u6DFB\u52A0\u6210\u529F")}).catch(r=>{console.error("\u65E0\u6CD5\u6DFB\u52A0\u6570\u636E:",r),alert("\u6570\u636E\u6DFB\u52A0\u6210\u529F")})}}},startAutoSave(){this.autoSaveTimer=setInterval(()=>{this.autoSaveHandle()},1e3*60*5)},stopAutoSave(){this.autoSaveHandle(),clearInterval(this.autoSaveTimer),this.autoSaveTimer=null},autoSaveHandle(){let e=this.runTime;if(this.runState===1&&(e+=performance.now()-this.startTime),e<60*1e3)return;let t={date:new Date().toLocaleString(),time:this.formatTime(Math.floor(e))};if(this.timeId!=-1){n.tempTimeRecord.update(this.timeId,t).then(()=>{}).catch(r=>{console.error("\u6570\u636E\u66F4\u65B0\u5931\u8D25:",r)});return}n.tempTimeRecord.add(t).then(async r=>{this.timeId=r;try{let o=await n.tempTimeRecord.count(),s=localStorage.getItem("tempTimeLength");s=Number(s)||100;let i=await n.tempTimeRecord.orderBy("id").limit(o-s).primaryKeys();if(i.length===0)return;await n.tempTimeRecord.bulkDelete(i)}catch(o){console.log(o),alert("\u5220\u9664\u81EA\u52A8\u4FDD\u5B58\u4E34\u65F6\u6570\u636E\u5931\u8D25")}}).catch(r=>{alert("\u81EA\u52A8\u4FDD\u5B58\u5931\u8D25")})},continueTime(e,t){confirm("\u662F\u5426\u786E\u8BA4\u7EE7\u7EED\uFF1F")!==!1&&(this.$refs.historyList.historyRecords.splice(e.oIdx,1),this.runTime+=e.time,this.startTime=performance.now(),n.timeRecord.delete(e.id).then(()=>{this.$refs.historyList.getData()}).catch(r=>{alert("\u6570\u636E\u5220\u9664\u5931\u8D25:",r)}),this.updateTimer())},addTimer(){confirm("\u662F\u5426\u786E\u8BA4\u52A0\u51CF\u65F6\u95F4?")!==!1&&(this.startTime=performance.now(),this.runTime+=this.addTime*1e3*60,this.runTime=Math.max(0,this.runTime),this.updateTimer())},startTimer(){this.startTime=performance.now(),this.updateTimer(),this.timerInterval=setInterval(this.updateTimer,1e3),this.runState=1},pauseTimer(){this.runTime+=performance.now()-this.startTime,this.startTime=performance.now(),this.runState=2,this.updateTimer(),clearInterval(this.timerInterval)},stopTimer(){clearInterval(this.timerInterval),this.runState===1&&(this.runTime+=performance.now()-this.startTime),n.timeRecord.add({date:new Date,time:Math.floor(this.runTime)}).then(e=>{this.startTime=null,this.formattedTime="00:00:00",this.runTime=0,this.runState=0,this.timeId=-1,this.$refs.historyList.getData()}).catch(e=>{alert("\u6DFB\u52A0\u5931\u8D25")})},updateTimer(){this.formattedTime=this.formatTime(performance.now()-this.startTime+this.runTime)},formatTime(e){e=Math.floor(Math.floor(e)/1e3);const t=Math.floor(e/3600).toString().padStart(2,"0"),r=Math.floor(e%3600/60).toString().padStart(2,"0"),o=(e%60).toString().padStart(2,"0");return`${t}:${r}:${o}`}}},I=e=>(R("data-v-f24d8560"),e=e(),b(),e),W={class:"timer_wrap"},X={class:"timer_header"},Z=I(()=>l("span",null,"\u8BA1\u65F6\u5668",-1)),ee=I(()=>l("hr",{class:"timer_hr"},null,-1)),te={class:"timer_show"},re={class:"timer-btn-list"},se=m(" \u5F00\u59CB "),ie=m(" \u6682\u505C "),ae=m(" \u7ED3\u675F "),oe=m(" \u52A0\u51CF\u65F6 ");function ne(e,t,r,o,s,i){const w=T("Tag"),u=T("AntButton"),c=T("InputNumber"),v=T("HistoryList");return d(),p("div",null,[l("section",W,[l("header",X,[Z,[0,1,2].includes(s.runState)?(d(),y(w,{key:0,bordered:!1,class:"timer_tag",color:i.getTag.color},{default:h(()=>[m(S(i.getTag.text),1)]),_:1},8,["color"])):g("",!0)]),ee,l("div",te,S(s.formattedTime),1),l("div",re,[_(u,{disabled:!(s.runState==0||s.runState==2),class:"start",size:"large",type:"primary",onClick:t[0]||(t[0]=f=>i.startTimer())},{default:h(()=>[se]),_:1},8,["disabled"]),_(u,{disabled:s.runState!=1,class:"pause",size:"large",type:"primary",onClick:t[1]||(t[1]=f=>i.pauseTimer())},{default:h(()=>[ie]),_:1},8,["disabled"]),_(u,{disabled:!(s.runState==1||s.runState==2),class:"stop",danger:"",size:"large",onClick:t[2]||(t[2]=f=>i.stopTimer())},{default:h(()=>[ae]),_:1},8,["disabled"]),s.runState==2?(d(),y(c,{key:0,style:{width:"120px","margin-left":"30px"},size:"large",type:"number",class:"common_input",value:s.addTime,"onUpdate:value":t[3]||(t[3]=f=>s.addTime=f)},null,8,["value"])):g("",!0),s.runState==2?(d(),y(u,{key:1,class:"",size:"large",onClick:t[4]||(t[4]=f=>i.addTimer())},{default:h(()=>[oe]),_:1})):g("",!0)])]),_(v,{ref:"historyList",formatTime:i.formatTime,runState:s.runState,onContinue:i.continueTime},null,8,["formatTime","runState","onContinue"])])}const de=k(Q,[["render",ne],["__scopeId","data-v-f24d8560"]]);export{de as default};
